{"ast":null,"code":"// Módulo para detectar ingredientes usando la API de Clarifai\n\n/**\r\n * Detecta ingredientes en una imagen usando la API de Clarifai\r\n * @param {string} imageData - Imagen en formato base64 o URL\r\n * @param {boolean} isBase64 - Indica si la imagen está en formato base64\r\n * @returns {Promise} - Promise que resuelve a un array de ingredientes con su confianza\r\n */\nconst detectarIngredientes = async (imageData, isBase64 = true) => {\n  // Configuración de la API de Clarifai\n  const USER_ID = 'fotoreceta';\n  const APP_ID = 'foto_receta';\n  const API_KEY = '439349bc92b24932ac284b252b5b1f0c';\n\n  // Cambiado a un ID de modelo verificado para alimentos\n  const MODEL_ID = 'food-item-v1-recognition';\n  try {\n    // Para depuración\n    console.log('Iniciando detección de ingredientes');\n\n    // Si es base64, limpiamos el encabezado si existe\n    let processedImageData = imageData;\n    if (isBase64 && imageData.startsWith('data:image')) {\n      processedImageData = imageData.split(',')[1];\n      console.log('Imagen procesada: Base64 con encabezado removido');\n    }\n\n    // Preparar los datos para la petición\n    const raw = JSON.stringify({\n      \"user_app_id\": {\n        \"user_id\": USER_ID,\n        \"app_id\": APP_ID\n      },\n      \"inputs\": [{\n        \"data\": {\n          \"image\": isBase64 ? {\n            \"base64\": processedImageData\n          } : {\n            \"url\": imageData\n          }\n        }\n      }]\n    });\n\n    // Para depuración - ver lo que se está enviando (sin mostrar toda la imagen)\n    console.log('Enviando solicitud a Clarifai:');\n    console.log('- Usuario:', USER_ID);\n    console.log('- App:', APP_ID);\n    console.log('- Modelo:', MODEL_ID);\n    console.log('- Tipo:', isBase64 ? 'base64' : 'url');\n\n    // Configuración de la petición\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Authorization': 'Key ' + API_KEY\n      },\n      body: raw\n    };\n\n    // Realizar la petición a la API de Clarifai\n    console.log('Enviando petición a:', `https://api.clarifai.com/v2/models/${MODEL_ID}/outputs`);\n    const response = await fetch(`https://api.clarifai.com/v2/models/${MODEL_ID}/outputs`, requestOptions);\n    const result = await response.json();\n\n    // Depuración - ver estructura de respuesta\n    console.log('Respuesta de Clarifai:', result);\n\n    // Verificar si hay errores en la respuesta\n    if (result.status && result.status.code !== 10000) {\n      throw new Error(`API Error: ${result.status.description || JSON.stringify(result.status)}`);\n    }\n\n    // Si no hay conceptos, retornar array vacío\n    if (!result.outputs || !result.outputs[0] || !result.outputs[0].data || !result.outputs[0].data.concepts) {\n      console.log('No se encontraron conceptos en la respuesta');\n      return [];\n    }\n\n    // Procesar los ingredientes detectados\n    const ingredientes = result.outputs[0].data.concepts.map(concept => ({\n      nombre: concept.name,\n      confianza: concept.value\n    }));\n    console.log('Ingredientes detectados:', ingredientes);\n\n    // Filtrar solo los ingredientes con confianza mayor a 0.6\n    const ingredientesFiltrados = ingredientes.filter(ingrediente => ingrediente.confianza > 0.6);\n    console.log('Ingredientes filtrados:', ingredientesFiltrados);\n    return ingredientesFiltrados;\n  } catch (error) {\n    console.error('Error al detectar ingredientes:', error);\n    // Añadir alerta para ver el error exacto en desarrollo\n    alert('Error técnico en Clarifai: ' + error.message);\n    throw error;\n  }\n};\n\n/**\r\n * Convierte una imagen de File a base64\r\n * @param {File} file - Archivo de imagen\r\n * @returns {Promise} - Promise que resuelve a la imagen en formato base64\r\n */\nconst fileToBase64 = file => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n};\n\n/**\r\n * Captura una imagen de la cámara y la convierte a base64\r\n * @param {HTMLVideoElement} videoElement - Elemento de video\r\n * @returns {Promise} - Promise que resuelve a la imagen en formato base64\r\n */\nconst captureImageFromCamera = videoElement => {\n  return new Promise((resolve, reject) => {\n    try {\n      const canvas = document.createElement('canvas');\n      canvas.width = videoElement.videoWidth;\n      canvas.height = videoElement.videoHeight;\n      const context = canvas.getContext('2d');\n      context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n      const dataUrl = canvas.toDataURL('image/jpeg');\n      resolve(dataUrl);\n    } catch (error) {\n      reject(error);\n    }\n  });\n};\nexport { detectarIngredientes, fileToBase64, captureImageFromCamera };","map":{"version":3,"names":["detectarIngredientes","imageData","isBase64","USER_ID","APP_ID","API_KEY","MODEL_ID","console","log","processedImageData","startsWith","split","raw","JSON","stringify","requestOptions","method","headers","body","response","fetch","result","json","status","code","Error","description","outputs","data","concepts","ingredientes","map","concept","nombre","name","confianza","value","ingredientesFiltrados","filter","ingrediente","error","alert","message","fileToBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","onerror","captureImageFromCamera","videoElement","canvas","document","createElement","width","videoWidth","height","videoHeight","context","getContext","drawImage","dataUrl","toDataURL"],"sources":["C:/Users/Usuario/Desktop/FotoReceta/src/services/detectarIngredientes.js"],"sourcesContent":["// Módulo para detectar ingredientes usando la API de Clarifai\r\n\r\n/**\r\n * Detecta ingredientes en una imagen usando la API de Clarifai\r\n * @param {string} imageData - Imagen en formato base64 o URL\r\n * @param {boolean} isBase64 - Indica si la imagen está en formato base64\r\n * @returns {Promise} - Promise que resuelve a un array de ingredientes con su confianza\r\n */\r\nconst detectarIngredientes = async (imageData, isBase64 = true) => {\r\n  // Configuración de la API de Clarifai\r\n  const USER_ID = 'fotoreceta';\r\n  const APP_ID = 'foto_receta';\r\n  const API_KEY = '439349bc92b24932ac284b252b5b1f0c';\r\n  \r\n  // Cambiado a un ID de modelo verificado para alimentos\r\n  const MODEL_ID = 'food-item-v1-recognition';\r\n\r\n  try {\r\n    // Para depuración\r\n    console.log('Iniciando detección de ingredientes');\r\n    \r\n    // Si es base64, limpiamos el encabezado si existe\r\n    let processedImageData = imageData;\r\n    if (isBase64 && imageData.startsWith('data:image')) {\r\n      processedImageData = imageData.split(',')[1];\r\n      console.log('Imagen procesada: Base64 con encabezado removido');\r\n    }\r\n\r\n    // Preparar los datos para la petición\r\n    const raw = JSON.stringify({\r\n      \"user_app_id\": {\r\n        \"user_id\": USER_ID,\r\n        \"app_id\": APP_ID\r\n      },\r\n      \"inputs\": [\r\n        {\r\n          \"data\": {\r\n            \"image\": isBase64 ? {\r\n              \"base64\": processedImageData\r\n            } : {\r\n              \"url\": imageData\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    // Para depuración - ver lo que se está enviando (sin mostrar toda la imagen)\r\n    console.log('Enviando solicitud a Clarifai:');\r\n    console.log('- Usuario:', USER_ID);\r\n    console.log('- App:', APP_ID);\r\n    console.log('- Modelo:', MODEL_ID);\r\n    console.log('- Tipo:', isBase64 ? 'base64' : 'url');\r\n\r\n    // Configuración de la petición\r\n    const requestOptions = {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Authorization': 'Key ' + API_KEY\r\n      },\r\n      body: raw\r\n    };\r\n\r\n    // Realizar la petición a la API de Clarifai\r\n    console.log('Enviando petición a:', `https://api.clarifai.com/v2/models/${MODEL_ID}/outputs`);\r\n    const response = await fetch(\r\n      `https://api.clarifai.com/v2/models/${MODEL_ID}/outputs`, \r\n      requestOptions\r\n    );\r\n    \r\n    const result = await response.json();\r\n    \r\n    // Depuración - ver estructura de respuesta\r\n    console.log('Respuesta de Clarifai:', result);\r\n    \r\n    // Verificar si hay errores en la respuesta\r\n    if (result.status && result.status.code !== 10000) {\r\n      throw new Error(`API Error: ${result.status.description || JSON.stringify(result.status)}`);\r\n    }\r\n\r\n    // Si no hay conceptos, retornar array vacío\r\n    if (!result.outputs || \r\n        !result.outputs[0] || \r\n        !result.outputs[0].data || \r\n        !result.outputs[0].data.concepts) {\r\n      console.log('No se encontraron conceptos en la respuesta');\r\n      return [];\r\n    }\r\n\r\n    // Procesar los ingredientes detectados\r\n    const ingredientes = result.outputs[0].data.concepts.map(concept => ({\r\n      nombre: concept.name,\r\n      confianza: concept.value\r\n    }));\r\n\r\n    console.log('Ingredientes detectados:', ingredientes);\r\n\r\n    // Filtrar solo los ingredientes con confianza mayor a 0.6\r\n    const ingredientesFiltrados = ingredientes.filter(ingrediente => ingrediente.confianza > 0.6);\r\n    console.log('Ingredientes filtrados:', ingredientesFiltrados);\r\n    \r\n    return ingredientesFiltrados;\r\n    \r\n  } catch (error) {\r\n    console.error('Error al detectar ingredientes:', error);\r\n    // Añadir alerta para ver el error exacto en desarrollo\r\n    alert('Error técnico en Clarifai: ' + error.message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Convierte una imagen de File a base64\r\n * @param {File} file - Archivo de imagen\r\n * @returns {Promise} - Promise que resuelve a la imagen en formato base64\r\n */\r\nconst fileToBase64 = (file) => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.onerror = (error) => reject(error);\r\n  });\r\n};\r\n\r\n/**\r\n * Captura una imagen de la cámara y la convierte a base64\r\n * @param {HTMLVideoElement} videoElement - Elemento de video\r\n * @returns {Promise} - Promise que resuelve a la imagen en formato base64\r\n */\r\nconst captureImageFromCamera = (videoElement) => {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = videoElement.videoWidth;\r\n      canvas.height = videoElement.videoHeight;\r\n      \r\n      const context = canvas.getContext('2d');\r\n      context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\r\n      \r\n      const dataUrl = canvas.toDataURL('image/jpeg');\r\n      resolve(dataUrl);\r\n    } catch (error) {\r\n      reject(error);\r\n    }\r\n  });\r\n};\r\n\r\nexport { detectarIngredientes, fileToBase64, captureImageFromCamera };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}